# search conf

user                        www www;
worker_processes            auto;
worker_cpu_affinity         auto;
error_log			        /usr/local/nginx/logs/error.log warn;

pid                         /usr/local/nginx/logs/nginx.pid;

worker_rlimit_core          1024M;
worker_rlimit_nofile        65535;

events {
    worker_connections      10240;
    use epoll;
}

http {
    server_tokens           off;

    include                 mime.types;

    types {
        application/x-compress  .Z;
        application/x-gzip      .gz .tgz;
        application/x-httpd-php .php .html;
    }

    default_type            text/plain;

    sendfile                on;
    tcp_nopush              on;
    tcp_nodelay             off;
    client_body_buffer_size 102400k;

    # keepalive
    keepalive_timeout       0;
    client_header_timeout   15s;

    # charset
    charset                 GBK;

    # gzip
    gzip                    on;
    gzip_http_version       1.0;
    gzip_comp_level         6;
    gzip_min_length         1024;
    gzip_proxied            any;
    gzip_vary               on;
    gzip_disable            msie6;

    # gzip_disable "MSIE [1-6]\.";
    gzip_buffers            64 8k;
    gzip_types              text/xml text/plain text/css application/javascript application/x-javascript application/rss+xml application/json application/xml;

    # fight mhtml/utf-7 bug
    hat_content             "\r\n";
    hat_types               text/html text/css;

    # waf, fight hashdos attack
    waf                              on;
    waf_max_post_params              1000;
    waf_max_args                     100;
    waf_max_cookies                  100;
    waf_post_delimiter_maxlen        70;

    # virtual servers
    include vhosts/*.conf;
}
